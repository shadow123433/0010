<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo</title>

<style>
body{
  margin:0;
  font-family: "Segoe UI", Arial;
  background:#f1f5f9;
}

/* HEADER */
header{
  background:linear-gradient(90deg,#0d6efd,#4da3ff);
  color:#fff;
  padding:18px 30px;
  font-size:22px;
  font-weight:600;
  box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

/* CONTAINER */
.container{
  padding:25px;
  max-width:1200px;
  margin:auto;
}

/* LOGIN */
.login-box{
  background:#fff;
  max-width:360px;
  margin:100px auto;
  padding:30px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}

.login-box input{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:6px;
  border:1px solid #ddd;
}

.login-box button{
  width:100%;
  padding:12px;
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

/* PAINEL */
.painel{
  display:none;
}

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

.logout{
  background:#dc3545;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}

/* CARDS */
.card{
  background:#fff;
  border-radius:12px;
  padding:18px;
  margin-bottom:18px;
  box-shadow:0 5px 18px rgba(0,0,0,0.06);
  transition:0.2s;
}

.card:hover{
  transform:translateY(-2px);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:10px;
  margin-bottom:10px;
}

.label{
  font-size:13px;
  color:#6b7280;
}

.value{
  font-weight:600;
}

/* STATUS BADGE */
.status{
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  font-weight:bold;
  display:inline-block;
}

.pendente{ background:#fff3cd; color:#856404; }
.pago{ background:#d1e7dd; color:#0f5132; }
.aguardando{ background:#cfe2ff; color:#084298; }
.retirado{ background:#e2e3e5; color:#41464b; }

/* AÇÕES */
.acoes{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.btn{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.btn-success{ background:#198754; color:#fff; }
.btn-delete{ background:#dc3545; color:#fff; }

.itens{
  margin-top:8px;
  font-size:14px;
  color:#374151;
}
</style>
</head>
<body>

<header>Painel Administrativo</header>

<div class="container">

<!-- LOGIN -->
<div class="login-box" id="loginBox">
  <h3>Login Admin</h3>
  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<!-- PAINEL -->
<div class="painel" id="painel">

  <div class="top-bar">
    <h2>Pedidos e Reservas</h2>
    <button class="logout" onclick="logout()">Sair</button>
  </div>

  <div id="listaPedidos"></div>

</div>
</div>

<script>
const API = "http://localhost:3000";

function getToken(){
  return localStorage.getItem("token");
}

function setToken(t){
  localStorage.setItem("token", t);
}

function logout(){
  localStorage.removeItem("token");
  location.reload();
}

/* LOGIN */
async function login() {
  const emailInput = document.getElementById("email");
  const senhaInput = document.getElementById("senha");

  const email = emailInput.value;
  const senha = senhaInput.value;

  const res = await fetch(API + "/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, senha })
  });

  const data = await res.json();

  if (!data.token) {
    alert("Login inválido");
    return;
  }

  setToken(data.token);
  iniciarPainel();
}

/* INICIAR */
function iniciarPainel(){
  loginBox.style.display="none";
  painel.style.display="block";

  carregarPedidos();
  setInterval(carregarPedidos,5000);
}

/* BUSCAR */
async function carregarPedidos(){
  const token = getToken();

  const res = await fetch(API + "/pedidos",{
    headers:{ "Authorization":"Bearer " + token }
  });

  const response = await res.json();
  const pedidos = response.data || [];

  const lista = document.getElementById("listaPedidos");
  lista.innerHTML="";

  pedidos.forEach(p => {

    let itensHtml = "";
    p.itens.forEach(item=>{
      for(const [tam,qtd] of Object.entries(item.tamanhos)){
        itensHtml += `<div>• ${item.produto} (${tam} x ${qtd})</div>`;
      }
    });

    const acaoTexto =
      p.tipo === "RESERVA"
      ? "Marcar como retirado"
      : "Marcar como pago";

    const novoStatus =
      p.tipo === "RESERVA"
      ? "retirado"
      : "pago";

    const card = document.createElement("div");
    card.className="card";

    card.innerHTML = `
  <div class="grid">
    <div>
      <div class="label">ID do Pedido</div>
      <div class="value">${p.pedidoID}</div>
    </div>

    <div>
      <div class="label">Tipo</div>
      <div class="value">${p.tipo}</div>
    </div>

    <div>
      <div class="label">Status</div>
      <div class="status ${p.status}">${p.status}</div>
    </div>

    <div>
      <div class="label">Nome</div>
      <div class="value">${p.nome}</div>
    </div>

    <div>
      <div class="label">Total</div>
      <div class="value">R$ ${Number(p.total).toFixed(2)}</div>
    </div>

    <div>
      <div class="label">Endereço</div>
      <div class="value">${p.endereco || "-"} ${p.numeroCasa || ""}</div>
    </div>

    <div>
      <div class="label">Referência</div>
      <div class="value">${p.referencia || "-"}</div>
    </div>
  </div>

      <div class="itens">${itensHtml}</div>

      <div class="acoes">
        <button class="btn btn-success" onclick="alterarStatus(${p.id}, '${novoStatus}')">
          ${acaoTexto}
        </button>

        <button class="btn btn-delete" onclick="deletarPedido(${p.id})">
          Excluir
        </button>
      </div>
    `;

    lista.appendChild(card);
  });
}

/* STATUS */
async function alterarStatus(id, status){
  const token = getToken();

  await fetch(API + "/pedidos/" + id + "/status",{
    method:"PATCH",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + token
    },
    body: JSON.stringify({ status })
  });

  carregarPedidos();
}

/* DELETE */
async function deletarPedido(id){
  if(!confirm("Excluir pedido?")) return;

  const token = getToken();

  await fetch(API + "/pedidos/" + id,{
    method:"DELETE",
    headers:{ "Authorization":"Bearer " + token }
  });

  carregarPedidos();
}

/* AUTO LOGIN */
if(getToken()){
  iniciarPainel();
}
</script>

</body>
</html>